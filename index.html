<!DOCTYPE html>
<html lang=en>
<head>
  <!-- so meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta property="og:type" content="website">
  <meta property="og:title" content="something">
  <meta property="og:url" content="https://github.com/Irreq">
  <meta property="og:site_name" content="name?">
  <meta property="og:locale" content="en_US">
  <meta property="article:author" content="t0st">
  <meta name="twitter:card" content="summary">

  <!-- title -->
  <title>Irreqs Site</title>
  <!-- styles -->

  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/terminal.css">
  <!-- rss -->
  <meta name="generator" content="Hexo 5.4.0">
</head>



<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">
    <header id="header">
      <a href="/">
        <div id="title">
          <h1>Hey</h1>
        </div>
        <div class="title">
          <h4>So yeah, welcome to my site<br>I'm Irreq btw</h4>
        </div>
      </a>
    </header>

<section id="terminal">
  <div class="mainCont">
    <div class="terminalCont">
      <div id="terminalContentsResult">
      </div>
      <form>
        <input id="terminalTextInput" type="text" placeholder="Try typing 'hi' or 'help'..." autocomplete="off">
      </form>
    </div>
  </div>
  <script type="text/javascript" src="js/terminal-backend.js"></script>
  <script type="text/javascript" src="js/chatbot.js"></script>
</section>
<section id="about">
  <!-- <p>Nothing in about</p> -->
  <div class="">
    <h1>About Me</h1>
    <p>I'm Irreq. I am an AI enthusiast with a peculiar inclination for learning and problem-solving. Whenever I am not working on my computer,
    you will find me running or riding Mountainbike in the local forests.<br><br>Picture is unrelated.</p>
    <br>
  </div>
  <p><img src="lib/images/ganman2.jpeg" alt="definately not me"></p>
<!-- <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="content" itemprop="articleBody">
  <h2 id="Problem-one-It’s…-strlen"><a href="#Problem-one-It’s…-strlen" class="headerlink" title="Problem one: It’s… strlen?!"></a>Problem one: It’s… strlen?!</h2><p>Disassembling the now-less-obfuscated dump reveals that one of the addresses has a label pulled out of somewhere! It’s <code>strlen</code>? Going down the call stack the next one is labeled <code>vscan_fn</code> and after that the labels end, tho I’m fairly confident it’s <a target="_blank" rel="noopener" href="https://github.com/chakra-core/ChakraCore/blob/master/pal/src/safecrt/sscanf.c#L47"><code>sscanf</code></a>.</p>
  <p><img src="/images/pasted-4.png" alt="A graph a day keeps the skeptics away"></p>
  <p>It’s parsing something. Parsing what? Untangling the disassembly would take forever so I decided to dump some samples from the running process using <a target="_blank" rel="noopener" href="https://x64dbg.com/">x64dbg</a>. Some debug-stepping later it turns out it’s… JSON! They’re parsing JSON. A whopping <strong>10 megabytes</strong> worth of JSON with some <strong>63k item entries</strong>.</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;WP_WCT_TINT_21_t2_v9_n2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">45000</span>,</span><br><span class="line">    <span class="attr">&quot;statName&quot;</span>: <span class="string">&quot;CHAR_KIT_FM_PURCHASE20&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;storageType&quot;</span>: <span class="string">&quot;BITFIELD&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;bitShift&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="attr">&quot;bitSize&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;category&quot;</span>: [<span class="string">&quot;CATEGORY_WEAPON_MOD&quot;</span>]</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</div>
</article> -->

<h2 id="Projects"><a href="#Projects" class="headerlink" title="Projects"></a>Projects</h2>
<p>I am working on several <a href="https://github.com/Irreq">projects</a>.</p>
<p>The plan? Write a <code>.dll</code>, inject it in GTA, <a target="_blank" rel="noopener" href="https://github.com/TsudaKageyu/minhook">hook</a> some functions, ???, profit.</p>
<p>The JSON problem is hairy, I can’t realistically replace their parser. Replacing <code>sscanf</code> with one that doesn’t depend on <code>strlen</code> would be more realistic. But there’s an even easier way.</p>
<ul>
<li>hook strlen</li>
<li>wait for a long string</li>
<li>“cache” the start and length of it</li>
<li>if it’s called again within the string’s range, return cached value</li>
</ul>
<p>Something like:</p>
<!-- <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">strlen_cacher</span><span class="params">(<span class="keyword">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span>* start;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span>* end;</span><br><span class="line">  <span class="keyword">size_t</span> len;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> cap = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if we have a &quot;cached&quot; string and current pointer is within it</span></span><br><span class="line">  <span class="keyword">if</span> (start &amp;&amp; str &gt;= start &amp;&amp; str &lt;= end) &#123;</span><br><span class="line">    <span class="comment">// calculate the new strlen</span></span><br><span class="line">    len = end - str;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we&#x27;re near the end, unload self</span></span><br><span class="line">    <span class="comment">// we don&#x27;t want to mess something else up</span></span><br><span class="line">    <span class="keyword">if</span> (len &lt; cap / <span class="number">2</span>)</span><br><span class="line">      MH_DisableHook((LPVOID)strlen_addr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// super-fast return!</span></span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// count the actual length</span></span><br><span class="line">  <span class="comment">// we need at least one measurement of the large JSON</span></span><br><span class="line">  <span class="comment">// or normal strlen for other strings</span></span><br><span class="line">  len = builtin_strlen(str);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if it was the really long string</span></span><br><span class="line">  <span class="comment">// save it&#x27;s start and end addresses</span></span><br><span class="line">  <span class="keyword">if</span> (len &gt; cap) &#123;</span><br><span class="line">    start = str;</span><br><span class="line">    end = str + len;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// slow, boring return</span></span><br><span class="line">  <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> -->

<p>And as for the hash-array problem, it’s more straightforward - just skip the duplicate checks entirely and insert the items directly since we know the values are unique.</p>
<!-- <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __fastcall <span class="title">netcat_insert_dedupe_hooked</span><span class="params">(<span class="keyword">uint64_t</span> catalog, <span class="keyword">uint64_t</span>* key, <span class="keyword">uint64_t</span>* item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// didn&#x27;t bother reversing the structure</span></span><br><span class="line">  <span class="keyword">uint64_t</span> not_a_hashmap = catalog + <span class="number">88</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// no idea what this does, but repeat what the original did</span></span><br><span class="line">  <span class="keyword">if</span> (!(*(<span class="keyword">uint8_t</span>(__fastcall**)(<span class="keyword">uint64_t</span>*))(*item + <span class="number">48</span>))(item))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// insert directly</span></span><br><span class="line">  netcat_insert_direct(not_a_hashmap, key, &amp;item);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// remove hooks when the last item&#x27;s hash is hit</span></span><br><span class="line">  <span class="comment">// and unload the .dll, we are done here :)</span></span><br><span class="line">  <span class="keyword">if</span> (*key == <span class="number">0x7FFFD6BE</span>) &#123;</span><br><span class="line">    MH_DisableHook((LPVOID)netcat_insert_dedupe_addr);</span><br><span class="line">    unload();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> -->

<p>Full source of PoC <a target="_blank" rel="noopener" href="https://github.com/tostercx/GTAO_Booster_PoC">here</a>.</p>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p>Well, did it work then?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Original online mode load time:        ~6m flat</span><br><span class="line">Time with only duplication check patch: 4m 30s</span><br><span class="line">Time with only JSON parser patch:       2m 50s</span><br><span class="line">Time with both issues patched:          1m 50s</span><br><span class="line"></span><br><span class="line">(6*60 - (1*60+50)) &#x2F; (6*60) &#x3D; 69.4% load time improvement (nice!)</span><br></pre></td></tr></table></figure>

<p>Hell yes, it did! :))</p>
<p>Most likely, this won’t solve everyone’s load times - there might be other bottlenecks on different systems, but it’s such a gaping hole that I have no idea how R* has missed it all these years.</p>
<h2 id="Small-update"><a href="#Small-update" class="headerlink" title="Small update"></a>Small update</h2><p>I was expecting to get some attention but nowhere near this much! After reaching the top of <a target="_blank" rel="noopener" href="https://news.ycombinator.com/item?id=26296339">HN</a> this post has spread like wildfire! <strong>Thank you for the overwhelming response :)</strong></p>
<p>I’ll do more writing if something interesting comes along, but don’t expect anything of this scale soon - there was a lot of luck involved.</p>
<p>A few people suggested spamming this post to Rockstar’s support - please don’t! I’m sure they’ve seen this by now. Continuing would only bog down support tickets for everyone else. Social media is fair game in my book tho.</p>
<p>Several HN comments suggested I add a donate button, as they would like to buy me a beer (thank you!) so I’m placing a link in the footer.</p>
<p>Thank you for reading and all the support :)</p>
<h2 id="Update-2021-03-15"><a href="#Update-2021-03-15" class="headerlink" title="Update 2021-03-15"></a>Update 2021-03-15</h2><ul>
<li>Got confirmation from R* that this is getting a fix soon</li>
<li>Just got awarded $10k through their H1 in-game bounty as an exception :)) (usually only for security issues)</li>
<li>Trying to figure out what’s a W8 and how to fill it (lol)</li>
<li>I did try asking for more technical details but they couldn’t say anything</li>
<li>Will do another  benchmark on my same old setup as soon as the update is out, I’m sure their engineers won’t disappoint :)</li>
</ul>


</section>
<section id="timeline">
  <div class="">
    <h1>Timeline</h1>
    <!-- <p>Well hello there, I'm Irreq. Picture below is unrelated.</p> -->
  </div>
  <ul class="post-list">
    <li class="post-item">
      <div class="meta">
        <time datetime="2021-04-01T14:00:00.000Z" itemprop="datePublished">2021-04-01</time>
      </div>
      <span>
        <a class="" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">file:///home/usr/old_passwds.xml</a>
      </span>
    </li>

    <li class="post-item">
      <div class="meta">
        <time datetime="2021-03-16T14:00:00.000Z" itemprop="datePublished">2021-03-16</time>
      </div>
      <span>
        <a class="" href="/">Find out what click-baiting is using these short tri...</a>
      </span>
    </li>

    <li class="post-item">
      <div class="meta">
        <time datetime="2021-02-28T14:00:00.000Z" itemprop="datePublished">2021-01-03</time>
      </div>
      <span>
        <a class="" href="/">Welcome to my webpage!</a>
      </span>
    </li>
  </ul>
</section>




<footer id="footer">
  <div class="footer-left">
    Copyright &copy;


    2021
    Irreq
  </div>

  <div class="footer-right">
    Fork me on <a style="color: #fc98fc" target="_blank" href="https://github.com/Irreq">GitHub!</a>
  </div>
</footer>

</div>

<!-- styles -->
<!-- <link rel="stylesheet" href="lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="lib/justified-gallery/css/justifiedGallery.min.css"> -->

<!-- jquery -->
<script src="lib/jquery/jquery.min.js"></script>
<!-- <script src="lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script> -->

<!-- clipboard -->
<script src="js/main.js"></script>
<script src="lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<!-- <script src="js/core.js"></script> -->
</body>
</html>
